<script src="../xlocalstorage.js"></script>
<script>
var result = [];

var usePromise = function(callback) {
  xLocalStorage.clear().then(function(e) {
    xLocalStorage.setItem('abc', 123).then(function(e) {
      xLocalStorage.getItem('abc').then(function(e) {
        if(e === '123') result.push(0);
        xLocalStorage.length().then(function(e) {
          if(e === 1) result.push(1);
          xLocalStorage.removeItem('abc').then(function(e) {
            xLocalStorage.length().then(function(e) {
              if(e === 0) result.push(2);
              callback();
            });
          });
        });
      });
    });
  });
};

var useCallback = function(callback) {
  xLocalStorage.clear(function(e) {
    xLocalStorage.setItem('abc', 123, function(e) {
      xLocalStorage.getItem('abc', function(e) {
        if(e === '123') result.push(3);
        xLocalStorage.length(function(e) {
          if(e === 1) result.push(4);
          xLocalStorage.removeItem('abc', function(e) {
            xLocalStorage.length(function(e) {
              if(e === 0) result.push(5);
              callback();
            });
          });
        });
      });
    });
  });
};

usePromise(function() {
  useCallback(function() {
    console.log(result, 'done');
  });
});
</script>

